# 1С Бухгалтерия предприятия 8

Интеграция PricePlan c программой `1C Бухгалтерия Предприятия 8` реализована через внешнюю обработку \(расширение epf\). Это дает возможность, использовать модуль интеграции с биллингом в 1С без изменения структуры базовой конфигурации.

[Ссылка на загрузку последней актуальной версии](https://github.com/linskiy/priceplan_1C/blob/master/priceplan.epf).

Интеграция предусматривает двусторонний обмен данными: 1. PricePlan может передавать в 1С контрагентов, счета и закрывающие документы.

1. 1С может передавать в PricePlan информацию о поступивших платежах. 

## Установка внешней обработки в "1C Бухгалтерия Предприятия 8"

1. Сохраните файл внешней обработки `priceplan.epf` из раздела "Помощь" на диск вашего компьютера;
2. В 1С Бухгалтерия 3.0 откройте окно регистрации внешних обработок в меню "Сервис" - "Дополнительные отчеты и обработки" - "Дополнительные внешние обработки";
3. В открывшемся окне, нажмите кнопку "Добавить", в результате чего, откроется окно регистрации внешней обработки;
4. Нажмите кнопку "Создать" и ,в открывшемся окне, выберите файл внешней обработки \(\*.epf\) c диска компьютера;
5. Измените название обработки в поле "Наименование" \(если требуется\) и нажмите кнопку "ОК". Обработка зарегистрирована и готова к использованию.

## Использование внешней обработки

1. Откройте окно регистрации внешней обработки в меню "Сервис" - "Дополнительные отчеты и обработки" - "Дополнительные внешние обработки";
2. Запустите обработку двойным кликом мышки;

## Настройки подключения к PricePlan.

* Войдите в PricePlan, как суперпользователь;
* В правом верхнем меню выберите "Пользователи и API KEYS" \(иллюстрация 1.2\);

![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 1.2](../assets/1c-12.png)

* Скопируйте адрес сервера, пароль и api-key и заполните их в модуле 1С \(иллюстрация 1.3 и 1.1\);

![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 1.3](../assets/1c-13.png)

* Сохраните настройки и проверьте связь с сервером \(иллюстрация 1.1\). Должно появиться сообщение о том, что связь установлена успешно.

![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 1.1](../assets/1c-11.png)

* Модуль готов к обмену информацией.

## Загрузка документов PricePlan в 1С

* Во вкладке "Загрузка документов из PricePlan" выберите диапазон дат и организацию;
* Нажмите кнопку "Прочитать";

![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 2.1](../assets/1c-21.png)

* В блоке "Документы" появится список документов, удовлетворяющих заданным условиям;
* В блоке "Состав" - детали каждого документа;
* Выберите необходимые документы из списка и нажмите кнопку "Записать"\(иллюстрация 2.2\).;

![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 2.2](../assets/1c-22.png)

* Документы будут добавлены в 1С.
* Если контрагент еще не существует в 1С, то модуль обмена создаст нового.
* Если номенклатура не существует в 1С, то модуль обмена создаст новую.
* Проверьте загруженные документы в 1С и проведите их.

## Выгрузка платежей из 1С в PricePlan

* Во вкладке "Выгрузка платежей в PricePlan" выберите диапазон дат и организацию.
* Нажмите кнопку "Прочитать" \(иллюстрация 3.1\).![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 3.1](../assets/1c-31.png).
* В блоке "Документы" появится список платежей, удовлетворяющих выбранным условиям.
* Выберите необходимые платежи из списка и нажмите кнопку "Отправить" \(иллюстрация 3.2\).

![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 3.2](../assets/1c-32.png)

* Документы будут переданы в PricePlan.
* Дальнейшая обработка платежей происходит в разделе "Финансы" сервиса PricePlan \(иллюстрация 3.3\)

![&#x438;&#x43B;&#x43B;&#x44E;&#x441;&#x442;&#x440;&#x430;&#x446;&#x438;&#x44F; 3.3](../assets/1c-33.png)

## Последние обновления
### Версия 1.16
1. Добавлен новый тип документов - УПД (bill). При его пердаче в 1С будет создана реализация и СФ.
2. При выбраной опции "сквозная нумерация" УПД после отправки в 1С будет присвоен новый номер в обейих системах.

### Версия 1.15
1. Добавлен отчет: Сверка по остаткам взаиморасчетов между 1С и PricePlan
2. Документация перемещена на новый адрес: https://docs.priceplan.pro/1c-help

### Версия 1.14
1. В опциях добавлена возможность выбора независимой или сквозной нумерации
    - Независимая нумерация означает, что все первичные документы биллинга будут перенесены в 1С с номерами PricePlan
    - Сквозная нумерация означает, что при обмене данными номера документов биллинга будут заменены на номера 1С.
 2. В опциях добавлена возможность выбора отдельной папки в каталоге для номенклатуры PricePlan

### Версия 0.94
 Исправлена проблема дублирования элементов при создании номенклатуры в 1С. Сейчас логика такая:
1. При создании документа в 1С обработка ищет ID продукта биллинга в комментариях к номенклатуре. Если находит, то строка докумекнта создается с найденной номенклатурой.
2. Если услуга по ID не найдена, то  обработка ищет продукт по имени. Если находит, то строка докумекнта создается с найденной номенклатурой, a pp_product_id будет добавлен в комментарии услуги.
3. Если обработка не нашла услугу по первым 2 кhиетериям то она создаст новую услугу и добавит pp_product_id в комментарии.

### Версия 0.93
1. Добавлено логгирование в Журнал регистрации 1с, событие "Обработка_priceplan.ПоискКонтрагента". Администрирование - Обслуживание - Журнал регистрации.
2. Добавна опция: "Писать лог" в разделе нестроек

### Версия 0.91
Изменен алгоритм сопоcтавления контрагентов (matching).
**Было:** Сначала поиск по строке "%PricePlan:"+пУИД+"%", где пУИД берется из поля ИД загружаемой строки. И уже на 2-м этапе, если не найдено по данному параметру, то идет поиск по ИНН.
**Стало:** Сначала по ИНН потом  ИД потом Наименование