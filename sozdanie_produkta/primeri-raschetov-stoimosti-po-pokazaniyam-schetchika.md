## Пример 1. Ежемесячный расчет операторских минут со скидкой за количество

Допустим создан продукт с переменной "Операторских минут" в разделе "Счетчики".

.![](/assets/Selection_158.png)

Показания счетчика вносятся в PricePlan через API после завершения каждого звонка.

Расчет поизводится первого числа каждого месяца. Для этого было создано правило на закрытие дня:![](/assets/Selection_159.png) 

**ВАЖНО: Внесение показаний счетчика и расчет - это разные события в биллинге. Для того, чтобы расчитать стоимость и списать средства с баланса, необходими создать правило с действием "Произвести списание по счетчику" **

Допустим в течение предыдущего месяца были введены показания счетчика

1. 10 мин
2. 5 мин
3. 20 мин
4. 40 мин
5. 30 мин

Первого числа, в соответствии с правилом биллинг просуммирует все показания счетчика, со дня последнего расчета. Затем вычтет количество включенных в тариф \(бесплатных\) минут и применит скидку. В нашем случае это будет: 

`(105 - 10)* 16 * 0.9`

Итак, в результате наших настроек клиенту будет выставлен акт и счет на 1 368 р. за 5 звонков, совершенных в предыдущем месяце.

PricePlan может производить расчеты не только по сумме показаний счетчика, накопленных от момента последнего расчёта, но и

* По максимальному значению
* По минимальному значению
* По среднему значению
* По последнему значению
* Разности между показаниями текущего и предыдущего расчета.

Расчет можно производить раз в месяц, раз в день, или сразу после введения показания счетчика. Это зависит от условий договора с клиентом и бизнес правил вашей компании.

